<div class="bn-view-page">
  <div class="bn-entity-page-title">
    <h1>Consultation des données</h1>
  </div>

  <div *ngIf="displayWaitPanel" style="text-align: center">
    <img
      src="../../../../../assets/img/green-bird.svg"
      alt="Oiseaux"
      height="200px"
    />
    <div>Les données arrivent...</div>
  </div>

  <div *ngIf="!displayWaitPanel">
    <button
      mat-raised-button
      color="primary"
      (click)="onSearchAllDonneesButtonClicked()"
    >
      Afficher toutes les fiches espèces
    </button>
    <div>
      <form [formGroup]="searchForm">
        <!-- ID -->
        <mat-form-field>
          <input
            #input
            matInput
            [formControl]="searchForm.controls['id']"
            placeholder="ID"
            id="input-id"
            name="id"
            type="text"
          />
        </mat-form-field>

        <input-observateur
          [control]="searchForm.controls['observateur']"
          [observateurs]="observateurs"
        >
        </input-observateur>

        <!-- DATES -->
        <mat-form-field>
          <input
            matInput
            maxlength="5"
            [matDatepicker]="picker"
            placeholder="Date de début"
            id="input-from-date"
            name="from-date"
            [formControl]="searchForm.controls['fromDate']"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <mat-form-field>
          <input
            matInput
            maxlength="5"
            [matDatepicker]="pickerToDate"
            placeholder="Date de fin"
            id="input-to-date"
            name="to-date"
            [formControl]="searchForm.controls['toDate']"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerToDate"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerToDate></mat-datepicker>
        </mat-form-field>

        <!-- DEPARTEMENT / COMMUNE / LIEUDIT -->
        <input-lieudit
          formGroupName="lieuditGroup"
          [controlGroup]="searchForm.controls['lieuditGroup']"
          [departements]="departements$"
          [communes]="communes$"
          [lieuxdits]="lieuxdits$"
          [hideCoordinates]="true"
        >
        </input-lieudit>

        <!-- CLASSE / ESPECE -->
        <input-espece
          formGroupName="especeGroup"
          [controlGroup]="searchForm.controls['especeGroup']"
          [classes]="classes$"
          [especes]="especes$"
        ></input-espece>

        <input-nombre
          class="estimation-nombre-espece"
          [controlGroup]="searchForm.controls['nombreGroup']"
          [estimationsNombre]="estimationsNombre"
          formGroupName="nombreGroup"
        >
        </input-nombre>

        <!-- SEXE -->
        <input-sexe
          class="sexe-espece"
          [control]="searchForm.controls['sexe']"
          [sexes]="sexes"
        ></input-sexe>

        <!-- AGE  -->
        <input-age
          class="age-espece"
          [control]="searchForm.controls['age']"
          [ages]="ages"
        ></input-age>

        <input-distance
          [controlGroup]="searchForm.controls['distanceGroup']"
          [estimationsDistance]="estimationsDistance"
          formGroupName="distanceGroup"
        >
        </input-distance>

        <input-regroupement
          [control]="searchForm.controls['regroupement']"
        ></input-regroupement>

        <button
          mat-raised-button
          color="primary"
          (click)="onSearchButtonClicked()"
        >
          Lancer la recherche
        </button>
      </form>
    </div>

    <table-donnees [donneesToDisplay]="donneesToDisplay"></table-donnees>
  </div>

  <div *ngIf="false">
    <div>
      <div>
        <button
          mat-raised-button
          color="primary"
          (click)="onOpenQueryButtonClicked()"
        >
          Ouvrir une requête existante
        </button>
        <button
          mat-raised-button
          color="primary"
          (click)="onNewQueryButtonClicked()"
        >
          Nouvelle requête
        </button>
      </div>
      <div>
        <mat-tree
          [dataSource]="treeData"
          [treeControl]="treeControl"
          class="tree"
        >
          <!-- This is the tree node template for leaf nodes -->
          <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
            <li class="mat-tree-node">
              <mat-checkbox
                [checked]="isTreeCheckboxSelected(node.key)"
                (change)="onTreeCheckboxClicked($event.checked, node.key)"
                >{{ columns[node.key].displayName }}</mat-checkbox
              >
            </li>
          </mat-tree-node>
          <!-- This is the tree node template for expandable nodes -->
          <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
            <li>
              <div class="mat-tree-node">
                <button
                  mat-icon-button
                  matTreeNodeToggle
                  [attr.aria-label]="'toggle ' + node.key"
                >
                  <mat-icon class="mat-icon-rtl-mirror">
                    {{
                      treeControl.isExpanded(node)
                        ? "expand_more"
                        : "chevron_right"
                    }}
                  </mat-icon>
                </button>
                {{ node.key }}
              </div>
              <ul [class.tree-invisible]="!treeControl.isExpanded(node)">
                <ng-container matTreeNodeOutlet></ng-container>
              </ul>
            </li>
          </mat-nested-tree-node>
        </mat-tree>
      </div>
    </div>

    <div>
      <div>Query Name</div>

      <div>
        <div>
          <button
            mat-raised-button
            color="primary"
            (click)="onAddSelectButtonClicked()"
          >
            Afficher
          </button>
        </div>

        <div>
          Colonnes à afficher:
          <table mat-table [dataSource]="selectTableDataSource">
            <
            <!-- Up/down buttons -->
            <ng-container matColumnDef="updown">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let row">
                <button
                  mat-raised-button
                  color="primary"
                  (click)="onUpSelectRowButtonClicked(row)"
                >
                  Monter
                </button>
                <button
                  mat-raised-button
                  color="primary"
                  (click)="onDownSelectRowButtonClicked(row)"
                >
                  Descendre
                </button>
              </td>
            </ng-container>

            <!-- Fonction -->
            <ng-container matColumnDef="function">
              <th mat-header-cell *matHeaderCellDef>Fonction</th>
              <td mat-cell *matCellDef="let row"></td>
            </ng-container>

            <!-- Colonne -->
            <ng-container matColumnDef="column">
              <th mat-header-cell *matHeaderCellDef>Colonne</th>
              <td mat-cell *matCellDef="let row">
                {{ columns[row.key].displayName }}
              </td>
            </ng-container>

            <!-- Tri -->
            <ng-container matColumnDef="ordering">
              <th mat-header-cell *matHeaderCellDef>Tri</th>
              <td mat-cell *matCellDef="let row">{{ row.ordering }}</td>
            </ng-container>

            <!-- Grouper -->
            <ng-container matColumnDef="groupby">
              <th mat-header-cell *matHeaderCellDef>Grouper</th>
              <td mat-cell *matCellDef="let row">{{ row.groupBy }}</td>
            </ng-container>

            <!-- Modifier -->
            <ng-container matColumnDef="edit">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let row">
                <button
                  mat-raised-button
                  color="primary"
                  (click)="onEditSelectRowButtonClicked(row.key)"
                >
                  Modifier
                </button>
              </td>
            </ng-container>

            <!-- Supprimer -->
            <ng-container matColumnDef="delete">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let row">
                <button
                  mat-raised-button
                  color="primary"
                  (click)="onDeleteSelectRowButtonClicked(row)"
                >
                  Supprimer
                </button>
              </td>
            </ng-container>

            <!-- Lines -->
            <tr
              mat-header-row
              *matHeaderRowDef="selectTableDisplayedColumns"
            ></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: selectTableDisplayedColumns"
            ></tr>
          </table>
        </div>
      </div>

      <div>
        <button
          mat-raised-button
          color="primary"
          (click)="onAddWhereButtonClicked()"
        >
          Filtrer
        </button>
        <div>
          <div>
            <table mat-table [dataSource]="whereTableDataSource">
              <
              <!-- Up/down buttons -->
              <ng-container matColumnDef="updown">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let row">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="onUpWhereRowButtonClicked(row)"
                  >
                    Monter
                  </button>
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="onDownWhereRowButtonClicked(row)"
                  >
                    Descendre
                  </button>
                </td>
              </ng-container>

              <!-- Colonne -->
              <ng-container matColumnDef="column">
                <th mat-header-cell *matHeaderCellDef>Colonne</th>
                <td mat-cell *matCellDef="let row">
                  {{ columns[row.key].displayName }}
                </td>
              </ng-container>

              <!-- Modifier -->
              <ng-container matColumnDef="edit">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let row">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="onEditWhereRowButtonClicked(row.key)"
                  >
                    Modifier
                  </button>
                </td>
              </ng-container>

              <!-- Supprimer -->
              <ng-container matColumnDef="delete">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let row">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="onRemoveWhereRowButtonClicked(row)"
                  >
                    Supprimer
                  </button>
                </td>
              </ng-container>

              <!-- Lines -->
              <tr
                mat-header-row
                *matHeaderRowDef="whereTableDisplayedColumns"
              ></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: whereTableDisplayedColumns"
              ></tr>
            </table>
          </div>
          <div>
            <button
              mat-raised-button
              color="primary"
              (click)="onAddLogicalOperatorButtonClicked('and')"
            >
              ET
            </button>
            <button
              mat-raised-button
              color="primary"
              (click)="onAddLogicalOperatorButtonClicked('or')"
            >
              OU
            </button>
            <button
              mat-raised-button
              color="primary"
              (click)="onAddLogicalOperatorButtonClicked('openingParenthesis')"
            >
              (
            </button>
            <button
              mat-raised-button
              color="primary"
              (click)="onAddLogicalOperatorButtonClicked('closingParenthesis')"
            >
              )
            </button>
          </div>
        </div>
      </div>
      <div>
        <button
          mat-raised-button
          color="primary"
          (click)="onSaveQueryButtonClicked()"
        >
          Sauvegarder la requête
        </button>
        <button
          mat-raised-button
          color="primary"
          (click)="onSearchButtonClicked()"
        >
          Lancer la recherche
        </button>
      </div>
    </div>
  </div>
</div>
